<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>找车找货找司机 就上驾运帮</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }
      .r-bg {
        top: 0;
        left: 0;
        position: fixed;
        width: 100%;
        height: 100%;
        /* background-image: url(./1.png); */
        background-color: #e5f5f5;
        filter: blur(60px);
        z-index: -1;
      }
      html {
        font-size: 16px;
      }
      .r-ul {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 80vh;
      }
      .r-li {
        position: relative;
        width: 80vw;
        border-bottom: 1px solid #ddd;
      }
      .r-li:last-child {
        border: 0;
      }
      .r-li input {
        margin: 0.4rem 0;
        height: 2.2rem;
        line-height: 2.2rem;
        font-size: 1.2rem;
        width: 100%;
        border: none;
        outline: none;
        color: #333;
        background-color: transparent;
      }
      .r-li button {
        margin-top: 1rem;
        height: 2.2rem;
        line-height: 2.2rem;
        font-size: 1rem;
        width: 100%;
        border: none;
        background: #f56662;
        color: #fff;
        border-radius: 0.2rem;
        border-bottom: 0;
      }
      .code-btn {
        position: absolute;
        padding: 0 0.3rem;
        border: 1px solid #f56662;
        height: 1.8rem;
        line-height: 1.8rem;
        right: 0;
        top: 0.5rem;
        border-radius: 0.2rem;
        font-size: 0.7rem;
        color: #f56662;
        cursor: pointer;
      }
      .disable-btn {
        position: absolute;
        padding: 0 0.3rem;
        border: 1px solid #666;
        height: 1.8rem;
        line-height: 1.8rem;
        right: 0;
        top: 0.5rem;
        text-align: center;
        min-width: 2rem;
        border-radius: 0.2rem;
        font-size: 0.7rem;
        color: #666;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="app" class="r-ul">
      <div class="r-li">
        <input v-model="phone" type="text" maxlength="11" minlength="11" placeholder="请输入手机号码" />
      </div>
      <div class="r-li">
        <input v-model="authCode" type="text" maxlength="4" minlength="4" placeholder="请输入验证码" />
        <span :class="isCode ? 'disable-btn':'code-btn'" @click="getAuth">{{btnMsg}}</span>
      </div>
      <div class="r-li">
        <input v-model="pwd" type="password" placeholder="设置密码" @blur="onPwd" />
      </div>
      <div class="r-li">
        <input v-model="rePwd" type="password" placeholder="确认密码" />
      </div>
      <div class="r-li">
        <input v-model="recommend" type="text" placeholder="请输入推荐人邀请码" />
      </div>
      <div class="r-li">
        <button @click="onSubmit">免费办卡</button>
      </div>
    </div>
    <div class="r-bg"></div>
  </body>
  <script>
    new Vue({
      el: '#app',
      data: {
        phone: '18766488847',
        authCode: '',
        pwd: '',
        rePwd: '',
        recommend: '',
        timeout: 10,
        isCode: false,
        btnMsg: '获取验证码',
      },
      computed: {
        isPhone() {
          return /\d{11}/.test(this.phone)
        },
      },
      methods: {
        getAuth() {
          if (this.isCode) return
          if (!this.isPhone) {
            alert('请输入合法的手机号码')
            return
          }
          this.timer = setInterval(() => {
            this.isCode = true
            this.btnMsg = `${--this.timeout}s`
            if (this.timeout < 0) {
              clearInterval(this.timer)
              this.timeout = 10
              this.isCode = false
              this.btnMsg = '获取验证码'
            }
          }, 1000)
          axios
            .post('http://120.27.145.178/getverifycode', {
              phone: this.phone, //手机号
              type: 0, //验证类型
            })
            .then(function(response) {
              if (response.status === 200) {
                console.log(response)
                this.code = response.data.data.code
              }
            })
            .catch(function(error) {
              alert(error)
            })
        },
        onPwd() {
          if (this.pwd.length < 8) {
            alert('密码最少输入8位')
            return
          }
        },
        onSubmit() {
          if (!this.isPhone) {
            alert('请输入合法的手机号码')
            return
          }
          if (!this.phone || !this.authCode || !this.pwd || !this.rePwd) {
            alert('请完成信息录入')
            return
          }
          if (this.pwd.length < 8) {
            alert('密码最少输入8位')
            return
          }
          if (this.pwd !== this.rePwd) {
            alert('两次密码输入不一致')
            return
          }
          axios
            .post('http://120.27.145.178/registerSignByPwd', {
              mobile: this.phone, //手机号
              pwd: this.pwd,
              invitation_code: this.authCode,
              verifyCode: this.recommend,
            })
            .then(function(response) {
              if (response.status === 200) {
                this.code = response.data.data.code
              } else {
                alert(response.msg)
              }
            })
            .catch(function(error) {
              alert(error)
            })
        },
      },
    })
  </script>
</html>
